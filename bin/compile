#!/usr/bin/env ruby

# sync output
$stdout.sync = true

BUILD_DIR = ARGV[0]
CACHE_DIR = ARGV[1]
ARCHIVE_NAME = "freetds-1.00.9"

puts "-----> FreeTDS building in #{BUILD_DIR}"

puts "-----> Fetching & Extracting FreeTDS"
puts `mkdir -p #{CACHE_DIR}`
puts `curl ftp://ftp.freetds.org/pub/freetds/stable/freetds-1.00.9.tar.gz -o - | tar -xz -C #{CACHE_DIR} -f -`
puts `ls -al #{CACHE_DIR}`

puts "-----> Configurating FreeTDS"
puts `mkdir -p #{BUILD_DIR}/vendor/freetds`
puts `cd #{CACHE_DIR}/#{ARCHIVE_NAME} && ./configure --prefix=#{BUILD_DIR}/vendor/freetds --with-tdsver=7.3 && make && make install`